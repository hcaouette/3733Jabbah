<html><head><script type="text/javascript">
var add_url = "https://8pzpcdfj7l.execute-api.us-east-2.amazonaws.com/First/calendar"; //createSchedule
var delete_url = "https://8pzpcdfj7l.execute-api.us-east-2.amazonaws.com/First/calendar"; //deleteSchedule

function processResponse(arg1, arg2, arg3, arg4, arg5, arg6) {

}
/* We probably won't use these, but in case we do:
function processGetUserResponse(result, arg2) {
    // Can grab any DIV or SPAN HTML element and can then manipulate its
    // contents dynamically via javascript
    console.log("result:" + result);
    var js = JSON.parse(result);

    var userCode = js["accessCode"];
    var orgCode = js["orgAccessCode"];
    var currentName = js["name"];
    var status      = js["httpCode"];

    if (status == 200) {
      // Update computation result
      document.addForm.result.value = computation
    } else {
      var msg = js["errorMessage"];
      document.addForm.result.value = "error:" + msg
    }
  }

function processGetScheduleResponse(result, arg2) {
    // Can grab any DIV or SPAN HTML element and can then manipulate its
    // contents dynamically via javascript
    console.log("result:" + result);
    var js = JSON.parse(result);

    var userCode = js["accessCode"];
    var orgCode = js["orgAccessCode"];
    var currentName = js["name"];
    var status      = js["httpCode"];

    if (status == 200) {
      // Update computation result
      document.addForm.result.value = computation
    } else {
      var msg = js["errorMessage"];
      document.addForm.result.value = "error:" + msg
    }
  }
*/
function firstLoad(){
    let output = "<label for='loginText'>Enter your access code here, if you're a system admin</label>";
    output+="<br><textarea id='loginText' rows='2' cols='20'></textarea>";
    output+="<button type='button' onclick='systemAdmin()'>System Admin</button>";
    output+="<br><br>";
    output+="<label for='newOrganizer'>Enter a Username to get started as an Organizer</label>";
    output+="<br><textarea id='newOrganizer' rows='2' cols='20'></textarea>";
    output+=" <button type='button' onclick='organizer()'>Organizer</button>";
    output+="<br><br>";
    output+="<label for='userText'>Enter a Username to get started as a participant</label>";
    output+="<br><textarea id='userText' rows='2' cols='20'></textarea>";
    output+="   <button type='button' onclick='participant()'>Participant</button>";

    document.getElementById("panelPrint").innerHTML = output;
}

function loadCal() {
    let interval = document.getElementById("meetingInterval").value;
    let numIntervals = 540 / interval;
    let myTable = "<table><tr><td style='font-size:16px;'>TIME</td>";
    myTable += "<td>MON</td>";
    myTable += "<td>TUE</td>";
    myTable += "<td>WED</td>";
    myTable += "<td>THU</td>";
    myTable += "<td>FRI</td></tr>";

    for (let i = 0; i < numIntervals; i++) {
        let currTime = (i*interval);
        let nexTime = ((i+1)*interval);
        myTable += "<tr><td>"+currTime+"-"+nexTime+"</td>";
        myTable += "<td><button type='button' onclick='bookFunc()'>Click Me!</button></td>";
        myTable += "<td><button type='button' onclick='bookFunc()'>Click Me!</button></td>";
        myTable += "<td><button type='button' onclick='bookFunc()'>Click Me!</button></td>";
        myTable += "<td><button type='button' onclick='bookFunc()'>Click Me!</button></td>";
        myTable += "<td><button type='button' onclick='bookFunc()'>Click Me!</button></td></tr>";
    }

    myTable += "</table>";
    /**console.log(myTable);*/
    document.getElementById("tablePrint").innerHTML = myTable;
}

function bookFunc(){
    window.confirm("Please confirm you want to book");
}

function makeOrgId() {
    let text = "";
    let possible = "abcdefghijklmnopqrstuvwxyz";

    for (let i = 0; i < 10; i++)
      text += possible.charAt(Math.floor(Math.random() * possible.length));

    text += "O";
    return text;
  }

function makePartId() {
    let text = "";
    let possible = "abcdefghijklmnopqrstuvwxyz";

    for (let i = 0; i < 10; i++)
      text += possible.charAt(Math.floor(Math.random() * possible.length));

    text += "P";
    return text;
  }

function createSchedule(){

    //Schedule Creation:
    let orgAccessCode = makeOrgId();
    document.getElementById("currentInfo").innerHTML += " Org Access Code: " + orgAccessCode;
    let partAccessCode = makePartId();
    document.getElementById("currentInfo").innerHTML += " Participant Access Code: " + partAccessCode;
    //name creation is handled on the backend so it can be checked against the server
    let startDay = document.getElementById("createDate").value;
    let endDay = document.getElementById("endDate").value;
    let startTime = document.getElementById("startTime").value;
    let endTime = document.getElementById("endTime").value;
    let meetingInterval = document.getElementById("meetingInterval").value;
    let nameUsed = document.getElementById("scheduleName").value;
    //console.log(startDay, endDay, startTime, endTime, meetingInterval);
    /*JSON stuff*/
    let form = document.addForm;
    let arg1 = "qwertyuiopO";
    let arg2 = startDay;
    let arg3 = endDay;
    let arg4 = startTime;
    let arg5 = endTime;
    let arg6 = meetingInterval;
    let arg7 = nameUsed;

    let data = {};
    data["orgAccessCode"] = orgAccessCode; //have to be able to find organizer, (user),
    //and take their fields for the random access codes
    data["startTime"] = arg4;
    data["endTime"] = arg5;
    data["startDate"] = arg2;
    data["endDate"] = arg3;
    data["timeSlotLength"] = arg6;
    data["name"] = arg7;
    data["timeCreated"] = Math.floor(Date.now()); //get milliseconds since 1970
    data["initialParticipantAccessCode"] = partAccessCode;

    let js = JSON.stringify(data);
    console.log("JS:" + js);
    let xhr = new XMLHttpRequest();
    xhr.open("POST", add_url, true);

    // send the collected data as JSON
    xhr.send(js);

    // This will process results and update HTML as appropriate.
    xhr.onloadend = function () {
      console.log(xhr);
      console.log(xhr.request);
      if (xhr.readyState == XMLHttpRequest.DONE) {
        console.log ("XHR:" + xhr.responseText);
        //processResponse(orgAccessCode, arg2, arg3, arg4, arg5, arg6);
      } else {
        //processResponse("N/A", arg2, arg3, arg4, arg5, arg6);
      }
    };
    /*Lambda stuff*/
    /**
     * */

//    console.log("creating");
    loadCal();
}

function processDeleteResponse(result) {
    // Can grab any DIV or SPAN HTML element and can then manipulate its
    // contents dynamically via javascript
    console.log("deleted :" + result);

    //refreshSchedulesList();
  }

  function deleteSchedule(orgAccessCodeh) {
     if (confirm("Are you sure you want to delete the entered schedule?")) {
       processDelete(orgAccessCodeh);
     }
  }

  function processDelete(orgAccessCode) {
    let orgAccessCoded = document.getElementById("secretID").value;
    let data = {};
    data["orgAccessCode"] = orgAccessCoded;

    let js = JSON.stringify(data);
    console.log("JS:" + js);
    let xhr = new XMLHttpRequest();
    xhr.open("DELETE", delete_url, true);

    // send the collected data as JSON
    xhr.send(js);

    // This will process results and update HTML as appropriate.
    xhr.onloadend = function () {
      console.log(xhr);
      console.log(xhr.request);
      if (xhr.readyState == XMLHttpRequest.DONE) {
        console.log ("XHR:" + xhr.responseText);
        processDeleteResponse(xhr.responseText);
      } else {
        processDeleteResponse("N/A");
      }
    };
  }

function participant(){
    //take the entered name to store in the HTML
    document.getElementById("currentInfo").innerHTML = "Name: " + document.getElementById("userText").value;

    //show participant panel
    let output = "<p> User: Participant </p>"
    output+="<label for = 'secretID'>Enter your secret code here to access a previously created schedule:</label>";
    output+="<br><textarea id='secretID' rows='2' cols='20'></textarea>";
    output+="<br><label for = 'viewYearText'>Enter year here:</label>";
    output+="<br><textarea id='viewYearText' rows='2' cols='20' placeholder='yyyy'></textarea>";
    output+="<br><label for = 'viewMonthText'>Enter month here:</label>";
    output+="<br><textarea id='viewMonthText' rows='2' cols='20' placeholder='mm'></textarea>";
    output+="<br><label for = 'viewDayText'>Enter day of month here:</label>";
    output+="<br><textarea id='viewDayText' rows='2' cols='20' placeholder='dd'></textarea>";
    output+="<br><br>";
    output+="<button type='button' onclick='pullSchedule(participant)'>View Week</button>";

    output+="<br><br>";
    output+= "<label for='viewWeekdayText'>Enter the weekday here</label>";
    output+="<br><textarea id='viewWeekdayText' rows='2' cols='20'></textarea>";
    output+="<br><br>";
    output+= "<label for='viewStartTimeText'>Enter the starting time here</label>";
    output+="<br><textarea id='viewStartTimeText' rows='2' cols='20'></textarea>";
    output+="<br><br>";
    output+="<button type='button' onclick='searchOpenTimeslots()'>View Timeslots</button>"

    document.getElementById("panelPrint").innerHTML = output;
}

function systemAdmin(){
    //take the entered login info to store in the HTML
    document.getElementById("currentInfo").innerHTML = "Admin: " + document.getElementById("loginText").value;

    //show the systemAdmin panel
    let output = "<p> User: System Administrator </p>";

    output+="<p>View Schedules created within the past X hours. </p>";
    output+="<label for = 'numHours'>Enter the number of hours here:</label>";
    output+="<br><textarea id='numHours' rows='2' cols='20'></textarea>";
    output+="<br><br>";
    output+="<button type = 'button' onclick = 'listSchedules()'>View</button>";

    output+="<p>View/Delete Schedules that are more than X days old. </p>";
    output+="<label for = 'numDays'>Enter the number of days here:</label>";
    output+="<br><textarea id='numDays' rows='2' cols='20'></textarea>";
    output+="<br><br>";
    output+="<button type = 'button' onclick = 'listSchedules()'>View</button>";
    output+="<button type = 'button' onclick = 'deleteAllSchedules()'>Delete</button>";

    document.getElementById("panelPrint").innerHTML = output;
}

function organizer(){
    //take the entered name to store in the HTML
    document.getElementById("currentInfo").innerHTML = "Name: " + document.getElementById("newOrganizer").value;

    //show the panel for organizers
    let output = "<p> User: Organizer </p>";

    output+="<br><label for = 'viewYearText'>Enter year here:</label>";
    output+="<br><textarea id='viewYearText' rows='2' cols='20' placeholder='yyyy'></textarea>";
    output+="<br><label for = 'viewMonthText'>Enter month here:</label>";
    output+="<br><textarea id='viewMonthText' rows='2' cols='20' placeholder='mm'></textarea>";
    output+="<br><label for = 'viewDayText'>Enter day of month here:</label>";
    output+="<br><textarea id='viewDayText' rows='2' cols='20' placeholder='dd'></textarea>";
    output+="<br><br>";
    output+="<button type = 'button' onclick = 'pullSchedule(organizer)'>View Schedule</button>";
    output+="<button type = 'button' onclick = 'extendSchedule()'>Extend Schedule</button>";

    output+="<p>Close or Open time slots on a given day or all time slots at a given time </p>";
    output+="<label for = 'date'>Enter date here:</label>";
    output+="<br><textarea id='numDays' rows='2' cols='20'></textarea>";
    output+="<br><label for 'time'>Or enter time here:</label>";
    output+="<br><textarea id = 'time' rows='2' cols='20' placeholder='hh:mm'></textarea>";
    output+="<br><br>";
    output+="<button type = 'button' onclick = 'closeTimeSlot()'>Close Time Slots</button>";
    output+="<button type = 'button' onclick = 'openTimeSlot()'>Open Time Slots</button>";

    output+="<br><br>";
    output+="<p>Enter a starting and ending date:</p>";
    output+="<textarea id='createDate' rows='2' cols='20' placeholder='yyyy-mm-dd'></textarea>";
    output+="<textarea id='endDate' rows='2' cols='20' placeholder='yyyy-mm-dd'></textarea><br>";
    output+="<br><p>Enter a starting and ending time of day:</p>";
    output+="<textarea id='startTime' rows='2' cols='20' placeholder='hh:mm'></textarea>";
    output+="<textarea id='endTime' rows='2' cols='20' placeholder='hh:mm'></textarea>";
    output+="<br><p>Enter a time interval in minutes for meetings:</p>";
    output+="<textarea id='meetingInterval' rows='2' cols='20' placeholder='30'></textarea><br>";
    output+="<br><p>Enter a name for your schedule: (20 characters or less)</p>";
    output+="<textarea id='scheduleName' rows='2' cols='20' placeholder='My Schedule'></textarea><br>";
    output+="";
    output+="<br><button type='button' onclick='createSchedule()'>Create Schedule</button>";
    output+="<br><br>";
    output+="<label for = 'secretID'>Enter your secret code here to access/delete a previously created schedule:</label>";
    output+="<br><textarea id='secretID' rows='2' cols='20'></textarea>";
    output+="<br><br>";
    output+="<button type = 'button' onclick = 'deleteSchedule()'>Delete Schedule</button>";

    document.getElementById("panelPrint").innerHTML = output;
}
function pullSchedule(userType){

    console.log(userType);
    console.log("yeehaw");
    document.getElementById("panelPrint").innerHTML += "<br>pulling schedule for you now";
    //a new schedule would not be created for pulling up the week in a schedule,
    //instead it should get the days in a schedule based on what access code and info they enter
    //Schedule Creation:
    //name creation is handled on the backend so it can be checked against the server
    let secretID = document.getElementById("secretID").value;
    let viewDay = document.getElementById("viewDayText").value;
    let viewMonth = document.getElementById("viewMonthText").value;
    let viewYear = document.getElementById("viewYearText").value;
    console.log(secretID);
    console.log(viewDay);
    console.log(viewMonth);
    console.log(viewYear);
    //console.log(startDay, endDay, startTime, endTime, meetingInterval);
    /*JSON stuff*/
    let form = document.addForm;
    let arg2 = viewYear;
    let arg3 = viewMonth;
    let arg4 = viewDay;
    let arg5 = secretID;

    let data = {};
    data["viewYear"] = arg2;
    data["viewMonth"] = arg3;
    data["viewDay"] = arg4;
    data["participantID"] = arg5;


    let js = JSON.stringify(data);
    console.log("JS:" + js);
    let xhr = new XMLHttpRequest();
    xhr.open("POST", add_url, true);

  // send the collected data as JSON
  xhr.send(js);

    // This will process results and update HTML as appropriate.
    xhr.onloadend = function () {
      console.log(xhr);
      console.log(xhr.request);
      if (xhr.readyState == XMLHttpRequest.DONE) {
        console.log ("XHR:" + xhr.responseText);
        processResponse(orgAccessCode, arg2, arg3, arg4, arg5, arg6);
      } else {
        processResponse("N/A", arg2, arg3, arg4, arg5, arg6);
      }
    };
      console.log("creating");
    loadCal();
}
</script>

  <title>Jabbah-Cal</title>
  <meta charset="utf-8">
  <link rel="stylesheet" type="text/css" href="style.css">
  <!--<script src="script.js"></script> -->
</head>
<body onload="firstLoad()">
  <div class="layout">
  <div class="Header">Welcome to the Jabbah-cal</div>
    <div id="currentInfo"></div>
  </div>
    <div class="Panel">
        <div id="panelPrint"></div>
    </div>
    <div class="Cal">
        <div id="tablePrint"></div>
    </div>
  </div>

</body>
</html>
