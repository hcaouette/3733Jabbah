<html><head><script type="text/javascript">
var add_url = "https://8pzpcdfj7l.execute-api.us-east-2.amazonaws.com/First/calendar";

function processResponse(arg1, arg2, arg3, arg4, arg5, arg6) {
    //need the following parameters:
    //timeslotlength must be equal to 10, 15, 20, 30, or 60
    //startTime and endTime must be in format HH:MM, and start time must be before endtime
    //startDate and endDate must be in format, and startDate must be before endDate
    //since accessCode will be generated, it should handle itself
    /*&& (
            req.getTimeSlotLength() == 10 || req.getTimeSlotLength() == 15 || req.getTimeSlotLength() == 20 || req.getTimeSlotLength() == 30 || req.getTimeSlotLength() == 60) &&
            bothTimesValid && datesValid
            
            //test to see start and end time are valid:
            boolean bothTimesValid = false;
            boolean startTimeLengthValid = (req.getStartTime().length() == 5);
            boolean startTimeContentsValid = true;
            if (startTimeLengthValid) { //if proper length, check if contents
                //are valid
                for (int i=0; i<5; i++) {
                    char cvalid = req.getStartTime().charAt(i);
                    if (i == 2 && cvalid != ':') {
                        startTimeContentsValid = false;
                    }
                    else if (i != 2 && !Character.isDigit(cvalid)) {
                        startTimeContentsValid = false;
                    }
                }
            }
            boolean endTimeLengthValid = (req.getEndTime().length() == 5);
            boolean endTimeContentsValid = true;
            if (endTimeLengthValid) { //if proper length, check if contents
                //are valid
                for (int i=0; i<5; i++) {
                    char cvalid = req.getEndTime().charAt(i);
                    if (i == 2 && cvalid != ':') {
                        endTimeContentsValid = false;
                    }
                    else if (i != 2 && !Character.isDigit(cvalid)) {
                        endTimeContentsValid = false;
                    }
                }
            }
            //if both start and end time have valid formatting and contents, make sure
            //that the start time is after the end time and the timeslots are evenly divisible between them
            if (startTimeContentsValid && startTimeLengthValid && endTimeContentsValid && endTimeLengthValid) {
                int startTimeHour = (Character.getNumericValue(req.getStartTime().charAt(0)) * 10) + Character.getNumericValue(req.getStartTime().charAt(0));
                int endTimeHour = (Character.getNumericValue(req.getEndTime().charAt(0)) * 10) + Character.getNumericValue(req.getEndTime().charAt(0));
                int startTimeMin = (Character.getNumericValue(req.getStartTime().charAt(3)) * 10) + Character.getNumericValue(req.getStartTime().charAt(3));
                int endTimeMin = (Character.getNumericValue(req.getEndTime().charAt(3)) * 10) + Character.getNumericValue(req.getEndTime().charAt(3));
                int minDifference = endTimeMin - startTimeMin;
                if (startTimeHour > endTimeHour && (minDifference % req.getTimeSlotLength() == 0)) {
                    bothTimesValid = true;
                }
                else if (startTimeHour == endTimeHour && (minDifference % req.getTimeSlotLength() == 0) && minDifference > 0) {
                    bothTimesValid = true;
                }
            }

            //now test to make sure start date and end date are valid dates,
            //and ensure that startDate is before endDate

            boolean datesValid = (req.getStartDate().getTime() < req.getEndDate().getTime());*/
  //var computation = js["value"];

  // Update computation result
  //document.addForm.result.value = computation
}

function handleClick(e) {
  var form = document.addForm;
  var arg1 = "qwertyuiopO";
  var arg2 = form.arg2.value;
  var arg3 = form.arg3.value;
  var arg4 = form.arg4.value;
  var arg5 = form.arg5.value;
  var arg6 = form.arg6.value;

  var data = {};
  data["arg1"] = "qwertyuiopO";
  data["arg2"] = arg2;
  data["arg3"] = arg3;
  data["arg4"] = arg4;
  data["arg5"] = arg5;
  data["arg6"] = arg6;

  var js = JSON.stringify(data);
  console.log("JS:" + js);
  var xhr = new XMLHttpRequest();
  xhr.open("POST", add_url, true);

  // send the collected data as JSON
  xhr.send(js);

  // This will process results and update HTML as appropriate. 
  xhr.onloadend = function () {
    console.log(xhr);
    console.log(xhr.request);
    if (xhr.readyState == XMLHttpRequest.DONE) {
      console.log ("XHR:" + xhr.responseText);
      processResponse("qwertyuiopO", arg2, arg3, arg4, arg5, arg6);
    } else {
      processResponse("N/A", arg2, arg3, arg4, arg5, arg6);
    }
  };
}
function firstLoad(){
    let output = "<label for='loginText'>Enter your access code here, if you've logged in before, or have an access code for your organizer's schedule</label>";
    output+="<br><textarea id='loginText' rows='2' cols='20'></textarea>";
    output+="<button type='button' onclick='openViewPanel()'>Login</button>";
    output+="<br><br>";
    output+="<label for='newOrganizer'>Enter a Username to get started as a new Organizer</label>";
    output+="<br><textarea id='newOrganizer' rows='2' cols='20'></textarea>";
    output+=" <button type='button' onclick='openCreateMenu()'>Create Schedule</button>";
    output+="<br><br>";
    output+="<label for='userText'>Enter a username and the access code from your organizer to get started as a participant</label>";
    output+="<br><textarea id='userText' rows='2' cols='20'></textarea>";
    output+="  <textarea id='accessCode' rows='2' cols='20'></textarea>";
    output+="   <button type='button' onclick='newParticipant()'>Participant</button>";

    document.getElementById("panelPrint").innerHTML = output;
}

function loadCal() {
    let interval = document.getElementById("meetingInterval").value;
    let numIntervals = 540 / interval;
    let myTable = "<table><tr><td style='font-size:16px;'>TIME</td>";
    myTable += "<td>MON</td>";
    myTable += "<td>TUE</td>";
    myTable += "<td>WED</td>";
    myTable += "<td>THU</td>";
    myTable += "<td>FRI</td></tr>";

    for (let i = 0; i < numIntervals; i++) {
        let currTime = (i*interval);
        let nexTime = ((i+1)*interval);
        myTable += "<tr><td>"+currTime+"-"+nexTime+"</td>";
        myTable += "<td><button type='button' onclick='bookFunc()'>Click Me!</button></td>";
        myTable += "<td><button type='button' onclick='bookFunc()'>Click Me!</button></td>";
        myTable += "<td><button type='button' onclick='bookFunc()'>Click Me!</button></td>";
        myTable += "<td><button type='button' onclick='bookFunc()'>Click Me!</button></td>";
        myTable += "<td><button type='button' onclick='bookFunc()'>Click Me!</button></td></tr>";
    }

    myTable += "</table>";
    /**console.log(myTable);*/
    document.getElementById("tablePrint").innerHTML = myTable;
}

function bookFunc(){
    window.confirm("Please confirm you want to book");
}

function openViewPanel(){
    let str = document.getElementById('loginText').value;
    let userType = str//.slice(10);
    console.log(userType);
    let output = "";
    if(userType === "O"){
        Organizer();
    }else if(userType === "P"){
        newParticipant();
    }else if(userType === "S"){
        SystemAdmin();
    }
}

function openCreateMenu(){
    let output = "";
    output+="<p>Enter a starting and ending date:</p>";
    output+="<textarea id='createDate' rows='2' cols='20' placeholder='yyyy-mm-dd'></textarea>";
    output+="<textarea id='endDate' rows='2' cols='20' placeholder='yyyy-mm-dd'></textarea><br>";
    output+="<br><p>Enter a starting and ending time of day:</p>";
    output+="<textarea id='startTime' rows='2' cols='20' placeholder='hh:mm'></textarea>";
    output+="<textarea id='endTime' rows='2' cols='20' placeholder='hh:mm'></textarea>";
    output+="<br><p>Enter a time interval in minutes for meetings:</p>";
    output+="<textarea id='meetingInterval' rows='2' cols='20' placeholder='30'></textarea><br>";
    output+="<br><p>Enter a name for your schedule: (20 characters or less)</p>";
    output+="<textarea id='scheduleName' rows='2' cols='20' placeholder='My Schedule'></textarea><br>";
    output+="";
    output+="<br><button type='button' onclick='createSchedule()'>Create Schedule</button>";
    document.getElementById("panelPrint").innerHTML = output;
//    console.log("we gottem, boys");
}
function createSchedule(){
    //name creation is handled on the backend so it can be checked against the server
    let startDay = document.getElementById("createDate").value;
    let endDay = document.getElementById("endDate").value;
    let startTime = document.getElementById("startTime").value;
    let endTime = document.getElementById("endTime").value;
    let meetingInterval = document.getElementById("meetingInterval").value;
    let name = document.getElementById("scheduleName").value;
    //console.log(startDay, endDay, startTime, endTime, meetingInterval);
    /*JSON stuff*/
      var form = document.addForm;
    var arg1 = "qwertyuiopO";
    var arg2 = startDay;
    var arg3 = endDay;
    var arg4 = startTime;
    var arg5 = endTime;
    var arg6 = meetingInterval;
    var arg7 = name;

    var data = {};
    data["orgAccessCode"] = arg1; //have to be able to find organizer, (user),
    //and take their fields for the random access codes
    data["startTime"] = arg4;
    data["endTime"] = arg5;
    data["startDate"] = arg2;
    data["endDate"] = arg3;
    data["timeslotDuration"] = arg6;
    data["name"] = arg7;
    data["timeCreated"] = Math.floor(Date.now()); //get milliseconds since 1970
    data["initialParticipantAccessCode"] = "qwertyuiopP"

    var js = JSON.stringify(data);
    console.log("JS:" + js);
    var xhr = new XMLHttpRequest();
    xhr.open("POST", add_url, true);

  // send the collected data as JSON
  xhr.send(js);

    // This will process results and update HTML as appropriate. 
    xhr.onloadend = function () {
      console.log(xhr);
      console.log(xhr.request);
      if (xhr.readyState == XMLHttpRequest.DONE) {
        console.log ("XHR:" + xhr.responseText);
        processResponse("qwertyuiopO", arg2, arg3, arg4, arg5, arg6);
      } else {
        processResponse("N/A", arg2, arg3, arg4, arg5, arg6);
      }
    };
    /*Lambda stuff*/
    /**
     * */

//    console.log("creating");
    loadCal();
}

function newParticipant(){
    let output = "<p> User: Participant </p>" 
    output+="<label for='viewDayText'>Enter the day of the month here</label>";
    output+="<br><textarea id='viewDayText' rows='2' cols='20'></textarea>";
    output+="<br><br>";
    output+= "<label for='viewYearText'>Enter the year here</label>";
    output+="<br><textarea id='viewYearText' rows='2' cols='20'></textarea>";
    output+="<br><br>";
    output+= "<label for='viewMonthText'>Enter the month here</label>";
    output+="<br><textarea id='viewMonthText' rows='2' cols='20'></textarea>";
    output+="<br><br>";
    output+="<button type='button' onclick='pullSchedule()'>View Week</button>";
    
    output+="<br><br>";
    output+= "<label for='viewWeekdayText'>Enter the weekday here</label>";
    output+="<br><textarea id='viewWeekdayText' rows='2' cols='20'></textarea>";
    output+="<br><br>";
    output+= "<label for='viewStartTimeText'>Enter the starting time here</label>";
    output+="<br><textarea id='viewStartTimeText' rows='2' cols='20'></textarea>";
    output+="<br><br>";
    output+="<button type='button' onclick='pullSchedule()'>View Timeslots</button>"

    document.getElementById("panelPrint").innerHTML = output;
}

function SystemAdmin(){
    let output = "<p> User: System Administrator </p>";
    
    output+="<p>View Schedules created within the past X hours. </p>";
    output+="<label for = 'numHours'>Enter the number of hours here:</label>";
    output+="<br><textarea id='numHours' rows='2' cols='20'></textarea>";
    output+="<br><br>";
    output+="<button type = 'button' onclick = 'listSchedules()'>View</button>";
    
    output+="<p>View/Delete Schedules that are more than X days old. </p>";
    output+="<label for = 'numDays'>Enter the number of days here:</label>";
    output+="<br><textarea id='numDays' rows='2' cols='20'></textarea>";
    output+="<br><br>";
    output+="<button type = 'button' onclick = 'listSchedules()'>View</button>";
    output+="<button type = 'button' onclick = 'deleteAllSchedules()'>Delete</button>";
    
    document.getElementById("panelPrint").innerHTML = output;
}

function Organizer(){
    let output = "<p> User: Organizer </p>";
    
    output+="<label for = 'month'>Enter month here:</label>";
    output+="<br><textarea id='month' rows='2' cols='20'></textarea>";
    output+="<br><label for = 'dayOfMonth'>Enter day of month here:</label>";
    output+="<br><textarea id='dayOfMonth' rows='2' cols='20'></textarea>";
    output+="<br><label for = 'year'>Enter year here:</label>";
    output+="<br><textarea id='year' rows='2' cols='20'></textarea>";
    output+="<br><br>";
    output+="<button type = 'button' onclick = 'pullSchedule()'>View Schedule</button>";
    output+="<button type = 'button' onclick = 'extendSchedule()'>Extend Schedule</button>";
    
    output+="<p>Close or Open time slots on a given day or all time slots at a given time </p>";
    output+="<label for = 'date'>Enter date here:</label>";
    output+="<br><textarea id='numDays' rows='2' cols='20'></textarea>";
    output+="<br><label for 'time'>Or enter time here:</label>";
    output+="<br><textarea id = 'time' rows='2' cols='20' placeholder='hh:mm'></textarea>";
    output+="<br><br>";
    output+="<button type = 'button' onclick = 'closeTimeSlot()'>Close Time Slots</button>";
    output+="<button type = 'button' onclick = 'openTimeSlot()'>Open Time Slots</button>";
    
    output+="<br><br>";
    output+="<button type = 'button' onclick = 'deleteSchedule()'>Delete Schedule</button>";
    
    document.getElementById("panelPrint").innerHTML = output;
}
</script>

  <title>Jabbah-Cal</title>
  <meta charset="utf-8">
  <link rel="stylesheet" type="text/css" href="style.css">
  <!--<script src="script.js"></script> -->
</head>
<body onload="firstLoad()">
  <div class="layout">
  <!--<div class="Header">Welcome to the Jabbah-cal</div>-->
    <div class="Panel">
        <div id="panelPrint"></div>
    </div>
    <div class="Cal">
        <div id="tablePrint"></div>
    </div>
  </div>

</body>
</html>
